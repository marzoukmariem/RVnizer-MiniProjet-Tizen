<!--A Design by W3layouts
Author: W3layout
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Flat Profile App A Mobile App Flat Bootstrap Responsive Website Template | Single :: w3layouts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Flat Profile App Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android  Compatible web template, Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design"
    />
    <script type="application/x-javascript">
        addEventListener("load", function() {setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); }
    </script>
    <meta charset utf="8">
    <!--font-awsome-css-->
    <link rel="stylesheet" href="profilcss/css/font-awesome.min.css">
    <!--bootstrap-->
    <link href="profilcss/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <!--custom css-->
    <link href="profilcss/css/style.css" rel="stylesheet" type="text/css" />
    <!--component-css-->
    <script src="profilcss/js/jquery-2.1.4.min.js"></script>
    <script src="profilcss/js/bootstrap.min.js"></script>
    <!--script-->
    <script src="profilcss/js/bigSlide.js"></script>
    <!-- default-css-files -->
    <link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="css/flexslider.css" type="text/css" media="screen" />
    <link href="css/font-awesome.css" rel="stylesheet" type="text/css" media="all">
    <!-- default-css-files -->
    <!-- Online fonts -->
    <link href="//fonts.googleapis.com/css?family=Oxygen:300,400,700" rel="stylesheet">
    <!-- //Online fonts -->
    <!-- style.css-file -->
    <link href="css/style.css" rel='stylesheet' type='text/css' />
    <!-- //style.css-file -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
        		$('.menu-link').bigSlide();
        	});
    </script>
    <!--script-->
    <script src="profilcss/js/responsiveslides.min.js"></script>
    <script>
        $(function () {
        		  $("#slider").responsiveSlides({
        			auto: true,
        			nav: true,
        			speed: 500,
        			namespace: "callbacks",
        			pager: true,
        		  });
        		});
    </script>
    <!--script-->
    <script src="profilcss/js/pie-chart.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
           
			 $('#demo-pie-1').pieChart({
                barColor: '#68b828',
                trackColor: '#E4E2E2',
                lineCap: 'butt',
                lineWidth: 10,
                onStep: function (from, to, percent) {
                    $(this.element).find('.pie-value').text(Math.round(percent) + '%');
                }
            });

            $('#demo-pie-2').pieChart({
                barColor: '#5bc0de',
                trackColor: '#E4E2E2',
                lineCap: 'butt',
                lineWidth: 10,
                onStep: function (from, to, percent) {
                    $(this.element).find('.pie-value').text(Math.round(percent) + '%');
                }
            });

            $('#demo-pie-3').pieChart({
                barColor: '#d9534f',
                trackColor: '#E4E2E2',
                lineCap: 'square',
                lineWidth: 10,
                onStep: function (from, to, percent) {
                    $(this.element).find('.pie-value').text(Math.round(percent) + '%');
                }
            });

           
        });
    </script>
    <link href='//fonts.googleapis.com/css?family=Josefin+Sans:400,700italic,700,600italic,400italic,600,300italic,300,100italic,100' rel='stylesheet' type='text/css'>
</head>

<body>

    <div class="detalis-grids" style="background-color:white;">

        <div class="details-shade" id="user-detail" style="background-color:white;">


        </div>
        <div class="follow" style="background-color:white;">

            <br>
            <br>
            <br>
            <br>
            <section class="about" id="appointment">
                <div class="container">

                    <div class="about-grids">

                        <div class="col-md-9 col-sm-9 col-xs-9 abt-rt-grid">
                            <br>
                            <div class="abt-form text-center">
                                <form action="#" method="post" onSubmit="return false;">

                                    <div class="col-sm-4 col-xs-4 w3ls-lt-form">
                                        <div class="w3ls-pr">
                                        <input type="file" onchange="encodeImageFileAsURL(this)" placeholder="Select A picture" id="image-selecter">
                                            <input type="text" name="Address" placeholder="First Name" required="" id="firstName" />
                                            <input type="text" name="Address" placeholder="Last Name" required="" id="lastName" required="" />
                                            <input type="text" name="Address" placeholder="Email" required="" id="login" required="" />
                                            <input type="text" name="Address" placeholder="PhoneNumber" required="" id="phonenumber" required="" />
                                            <input type="text" name="Address" placeholder="Address" required="" id="address" required="" />
                                            <input type="text" name="Job" placeholder="Job" required="" id="job" required="" />
                                            <input type="date" name="Date" placeholder="Birth Date" required="" id="date" required="" />
                                            <input type="text" name="Job" placeholder="Job" required="" id="password" required="" />
                                            
                                            <div id="uploading-text" style="display:none;">Uploading...</div>
                                            
                                            <br>
                                            <br>

                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                    <input type="submit" value="Finish" id="login-button" onclick="finish()">
                                </form>
                                <div class="container">
                                    <div class="grid-wrap" id="rdv">

                                        <div class="clearfix"></div>
                                    </div>

                                </div>

                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>


                </div>
            </section>
        </div>
    </div>

    <script type="text/javascript">
        window.addEventListener('tizenhwkey', function(e) {
            if ( e.keyName == "back" ) {
                
                   window.location='AcceuilPatient.html';
                  
            }
        	});
        				
        				var seesionvar = sessionStorage.getItem("Iduser");
        	
        			var defaultEmail;		             
         $.ajax({
                    url: 'http://41.226.11.252:1180/medichelper/getInnfopatient.php?idpt=' +seesionvar ,
                    data: "", //ur data to be sent to server
                    contentType: "application/json; charset=utf-8", 
                    type: "GET",
                    success: function (data) {
                  	 
                     var testJson = JSON.parse(data);
                     var num = testJson[0].NumTel_User;
                     var prenom   = testJson[0].Prenom_User;
                     var nom = testJson[0].Nom_User;
                     var daten = testJson[0].DateNaissance_User;
                     var login = testJson[0].Login_User
                     var adress = testJson[0].Adresse_Patient
                     var cin = testJson[0].Cin_Patient
                     var imguser = testJson[0].UrlImage_Patient;
                     var im = 'http://41.226.11.252:1180/medichelper/'+imguser ;
                     var password = testJson[0].Password_User;
                     defaultEmail = login;	
                     document.getElementById('user-detail').innerHTML = document.getElementById('user-detail').innerHTML +'<div class="details-img" ><img id="preview" style="width: 150px;height:150px;" class="img-circle" src="'+im+'" alt=" "   /></div>';
                 
                     document.getElementById('firstName').value = nom
                     document.getElementById('lastName').value = prenom
                     document.getElementById('address').value = adress
                     document.getElementById('job').value = cin
                     document.getElementById('date').value = daten.substring(0, 10)
                     document.getElementById('phonenumber').value = num
                     document.getElementById('login').value = login
                     document.getElementById('password').value = password
                      
                     
   					var previewImage = document.getElementById("preview")
					
                    
                     
                    },
                    error: function (x, y, z) {
                       alert(x.responseText +"  " +x.status);
                    }
                });
    </script>

    <script>
        function encodeImageFileAsURL(element) {
          var file = element.files[0];
          var reader = new FileReader();
          reader.onloadend = function() {
            //console.log( reader.result)
            url = reader.result.slice(23)
            var img = new Image();
					img.src = reader.result;
					img.onload = function(){
						document.getElementById('preview').src = img.src
						
						}
          }
          reader.readAsDataURL(file);
        }
    </script>
    <script>
    function finish(){
if(document.getElementById('firstName').value==""){
	
	}else if(document.getElementById('lastName').value==""){
	
	}else if(document.getElementById('login').value==""){
	
	}else if(document.getElementById('phonenumber').value==""){
	
	}else if(document.getElementById('address').value==""){
	
	}else if(document.getElementById('job').value==""){
	
	}else if(document.getElementById('date').value==""){
	
	}else if(document.getElementById('password').value==""){
	
	}else{
	
	 $.ajax({
            url: 'http://41.226.11.252:1180/medichelper/login3.php?login=' + document.getElementById('login').value.trim() ,
            data: "", //ur data to be sent to server
            contentType: "application/json; charset=utf-8", 
            type: "GET",
            success: function (data) {
            var testJson = JSON.parse(data);
            console.log(testJson.length)
              if(testJson.length>0&&document.getElementById('login').value.trim()!==defaultEmail){
              document.getElementById("login").setCustomValidity("Email is already in use");
              }else{
              //////////////////////////////////////////////////////
	uploadImage();
	//////////////////////////////////////////////////////
        	
              }
           
            
             
            },
            error: function (x, y, z) {
               alert(x.responseText +"  " +x.status);
            }
        });
   
	}
}
</script>
<script>
function uploadImage() {
var idUser=sessionStorage.getItem("Iduser");
var uploadingText = document.getElementById("uploading-text");
	
	var imageSelecter = document.getElementById("image-selecter"),
		file = imageSelecter.files[0];
	if (!file){
		var formData = new FormData();
	formData.append("Id_User",idUser);
	formData.append("login", document.getElementById('login').value);
	formData.append("nom", document.getElementById('lastName').value);
	formData.append("numtel", document.getElementById('phonenumber').value);
	formData.append("pw", document.getElementById('password').value);
	formData.append("prenom", document.getElementById('firstName').value);
	formData.append("addresse", document.getElementById('address').value.trim());
	formData.append("cin", document.getElementById('job').value);
	formData.append("datenaiss", document.getElementById('date').value.trim());

	// do the ajax part
	var ajax = new XMLHttpRequest();
	ajax.onreadystatechange = function() {
		if (this.readyState === 4 && this.status === 200) {
			console.log("succeesful")
			alert("updated successfully");
			window.location="Profil.html";
 

		}
		else{
		console.log("unsucceesful")
		}
	}
	ajax.open("POST", "http://41.226.11.252:1180/medichelper/updatePatientTizenSansPhoto.php", true);
	ajax.send(formData); // send the form data
	}else{ 
		
	// clear the previous image
	
	// show uploading text
	uploadingText.style.display = "block";
	// create form data and append the file
	var formData = new FormData();
	console.log(sessionStorage.getItem("Iduser"),document.getElementById('login').value, document.getElementById('lastName').value, document.getElementById('password').value, document.getElementById('firstName').value,document.getElementById('address').value.trim(),document.getElementById('job').value, document.getElementById('date').value.trim());
	formData.append("Id_User",idUser);
	formData.append("image", url);
	formData.append("login", document.getElementById('login').value);
	formData.append("nom", document.getElementById('lastName').value);
	formData.append("numtel", document.getElementById('phonenumber').value);
	formData.append("pw", document.getElementById('password').value);
	formData.append("prenom", document.getElementById('firstName').value);
	formData.append("addresse", document.getElementById('address').value.trim());
	formData.append("cin", document.getElementById('job').value);
	formData.append("datenaiss", document.getElementById('date').value.trim());

	// do the ajax part
	var ajax = new XMLHttpRequest();
	ajax.onreadystatechange = function() {
		if (this.readyState === 4 && this.status === 200) {
			console.log("succeesful")
			alert("updated successfully");
			window.location="Profil.html";
 

		}
		else{
		console.log("unsucceesful")
		}
	}
	ajax.open("POST", "http://41.226.11.252:1180/medichelper/updatePatientTizen.php", true);
	ajax.send(formData); // send the form data
	}
}
</script>
